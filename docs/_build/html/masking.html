

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>masking module &mdash; amakihi  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="plotting module" href="plotting.html" />
    <link rel="prev" title="imalign module" href="imalign.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> amakihi
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">amakihi</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="amakihi.html">amakihi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="astroalign_mod.html">astroalign_mod module</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html">background module</a></li>
<li class="toctree-l2"><a class="reference internal" href="crop.html">crop module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ePSF.html">ePSF module</a></li>
<li class="toctree-l2"><a class="reference internal" href="imalign.html">imalign module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">masking module</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html">plotting module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_2MASS.html">query_2MASS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_CFIS.html">query_CFIS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_DECaLS.html">query_DECaLS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_PS1.html">query_PS1 module</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html">templates module</a></li>
<li class="toctree-l2"><a class="reference internal" href="transient.html">transient module</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amakihi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">amakihi</a> &raquo;</li>
        
      <li>masking module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/masking.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-masking">
<span id="masking-module"></span><h1>masking module<a class="headerlink" href="#module-masking" title="Permalink to this headline">¶</a></h1>
<p>Constructing masks.</p>
<p><strong>TO-DO:</strong></p>
<ul class="simple">
<li>Re-think saturated object size limits (can miss cosmic rays? is this OK?)</li>
</ul>
<dl class="function">
<dt id="masking.box_mask">
<code class="descclassname">masking.</code><code class="descname">box_mask</code><span class="sig-paren">(</span><em>image_file</em>, <em>pixx</em>, <em>pixy</em>, <em>mask_file=None</em>, <em>plot=False</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#masking.box_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a simple box-shaped mask delimited by input pixel coordinates,
optionally combined with an existing mask.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image_file</strong> (<em>str</em>) – Image (fits) filename</li>
<li><strong>pixx, pixy</strong> (<em>tuple</em>) – x-pixel pair and y-pixel pair denoting the bounds of the box to build</li>
<li><strong>mask_file</strong> (<em>str, optional</em>) – Existing mask image (fits) filename to combine existing mask with new
boxmask (default None)</li>
<li><strong>plot</strong> (<em>bool, optional</em>) – Whether to plot the mask (default False)</li>
<li><strong>write</strong> (<em>bool, optional</em>) – Whether to write the new mask to a fits file</li>
<li><strong>output</strong> (<em>str, optional</em>) – Name for output fits file (default
<cite>image_file.replace(“.fits”, “_boxmask.fits”)</cite>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">New HDU (image + header) for the mask (<strong>not</strong> the masked data)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">astropy.io.fits.PrimaryHDU</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="masking.saturation_mask">
<code class="descclassname">masking.</code><code class="descname">saturation_mask</code><span class="sig-paren">(</span><em>image_file</em>, <em>mask_file=None</em>, <em>sat_ADU=40000</em>, <em>sat_area_min=500</em>, <em>ra_safe=None</em>, <em>dec_safe=None</em>, <em>rad_safe=None</em>, <em>dilation_its=5</em>, <em>blur_sigma=2.0</em>, <em>plot=True</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#masking.saturation_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a mask of all saturated sources in an image, optionally combined
with an existing mask.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>image_file</strong> (<em>str</em>) – Image (fits) filename</li>
<li><strong>mask_file</strong> (<em>str, optional</em>) – Existing mask image (fits) filename to combine existing mask with new
saturation mask (default None)</li>
<li><strong>sat_ADU</strong> (<em>float, optional</em>) – ADU value above which a pixel is considered saturated (default 40000,
which is a bit below the limit for MegaCam)</li>
<li><strong>sat_area_min</strong> (<em>float, optional</em>) – <em>Minimum</em> pixel area for a source to be considered a saturated source
(default 500)</li>
<li><strong>ra_safe, dec_safe</strong> (<em>float, optional</em>) – Right Ascension and Declination (in decimal degrees) at the centre of a
“safe zone” in which sources will not be masked (default None), see
<cite>rad_safe</cite></li>
<li><strong>rad_safe</strong> (<em>float, optional</em>) – Radius (in arcsec) of the “safe zone”, a circle centered on
(<cite>ra_safe</cite>, <cite>dec_safe</cite>) (default None)</li>
<li><strong>dilation_its</strong> (<em>int, optional</em>) – Number of iterations of binary dilation to apply to the mask (see
notes for details; default 5; can be set to 0 turn this off)</li>
<li><strong>blur_sigma</strong> (<em>float, optional</em>) – Sigma of the Gaussian filter to apply to the mask to blur it (default
2.0; can be set to 0 to turn this off)</li>
<li><strong>plot</strong> (<em>bool, optional</em>) – Whether to plot the new saturation mask (default True)</li>
<li><strong>write</strong> (<em>bool, optional</em>) – Whether to write the new mask to a fits file (default True)</li>
<li><strong>output</strong> (<em>str, optional</em>) – Name for output fits file (default
<cite>image_file.replace(“.fits”, “_satmask.fits”)</cite>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><ul class="simple">
<li><strong>tbl</strong> (<em>astropy.table.table.Table</em>) – A table containing properties of the sources which were flagged as
saturated</li>
<li><strong>mask_hdu</strong> (<em>astropy.io.fits.PrimaryHDU</em>) – New HDU (image + header) for the mask (<strong>not</strong> the masked data)</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Uses image segmentation to find all sources in the image. Then, looks for
sources which have a maximum flux above the saturation ADU and above the
minimum saturation area and creates a mask of these sources.</p>
<p>Binary dilation is applied to to “dilate” (i.e., enlarge) features in the
mask, and Gaussian blurring is applied, to smooth out the mask and ensure
that saturated sources are completely masked. Binary dilation is very
helpful for catching diffraction spikes which are initially not completely
masked. <strong>Note</strong> however that both binary dilation and Gaussian blurring
can be disabled by setting <cite>dilation_its = 0</cite> and <cite>blur_sigma = 0</cite>,
respectively.</p>
<p>If a “safe zone” is supplied, any sources within the safe zone will be
labelled as NON-saturated. This is useful if you know the coordinates of
some galaxy/nebulosity in your image which should not be masked, as it is
sometimes difficult to distinguish between a saturated source and a galaxy.</p>
<p>If an existing mask is supplied, the output mask will be a combination of
the previous mask and saturation mask.</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plotting.html" class="btn btn-neutral float-right" title="plotting module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="imalign.html" class="btn btn-neutral float-left" title="imalign module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Nicholas Vieira

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>