

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>amakihi module &mdash; amakihi  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="astroalign_mod module" href="astroalign_mod.html" />
    <link rel="prev" title="amakihi" href="modules.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> amakihi
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">amakihi</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">amakihi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="astroalign_mod.html">astroalign_mod module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_2MASS.html">query_2MASS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_CFIS.html">query_CFIS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_DECaLS.html">query_DECaLS module</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_PS1.html">query_PS1 module</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amakihi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">amakihi</a> &raquo;</li>
        
      <li>amakihi module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/amakihi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-amakihi">
<span id="amakihi-module"></span><h1>amakihi module<a class="headerlink" href="#module-amakihi" title="Permalink to this headline">¶</a></h1>
<p>Created on Thu Aug  1 13:58:03 2019
&#64;author: Nicholas Vieira
&#64;amakihi.py</p>
<p>This script contains a library of functions for downloading templates and all
other steps required for image differencing/subtraction: cropping, background-
subtraction, registration (alignment) and masking out of bad pixels, including
saturated stars. Can then perform image subtraction using hotpants.</p>
<p><strong>hotpants:</strong> <a class="reference external" href="https://github.com/acbecker/hotpants">https://github.com/acbecker/hotpants</a></p>
<p>To be implemented: Proper Image Subtraction (ZOGY formalism) presented in
Zackay et al. 2016. [1]</p>
<p>Zackay et al: <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016ApJ...830...27Z/abstract">https://ui.adsabs.harvard.edu/abs/2016ApJ…830…27Z/abstract</a></p>
<dl class="docutils">
<dt>Templates can be downloaded from each survey in the corresponding filters:</dt>
<dd><ul class="first last simple">
<li>Pan-STARRS 1 (PS1):                           g, r, i, z, y</li>
<li>Dark Energy Camera Legacy Survey (DECaLS):    g, r, z</li>
<li>Canada-France Imaging Survey (CFIS):          u, r</li>
<li>2MASS:                                        J, H, K</li>
</ul>
</dd>
</dl>
<p>IMPORTANT NOTE: this software makes use of a slightly modified version of the
astroalign software developed by Martin Beroiz and the TOROS Dev Team. The
original software can be seen here:</p>
<p><strong>astroalign:</strong> <a class="reference external" href="https://github.com/toros-astro/astroalign">https://github.com/toros-astro/astroalign</a></p>
<p>I claim absolutely no ownership of this software. The additions I have made to
the software are mostly superficial and have to do with error handling.</p>
<dl class="docutils">
<dt>SECTIONS:</dt>
<dd><ul class="first last simple">
<li>Downloading templates</li>
<li>Cropping images</li>
<li>Background subtraction</li>
<li>Image registraton (alignment)</li>
<li>Mask building (boxmask, saturation mask)</li>
<li>ePSF building</li>
<li>Image differencing with HOTPANTS</li>
<li>Transient detection, triplets</li>
<li>Miscellaneous plotting</li>
</ul>
</dd>
<dt>GENERAL DEPENDENCIES NOT INCLUDED ON THIS SOFTWARE’S GITHUB:</dt>
<dd><ul class="first last simple">
<li>astropy (used extensively)</li>
<li>photutils (used extensively)</li>
<li><dl class="first docutils">
<dt>astrometry.net (used extensively, but can be ignored in favour of</dt>
<dd>source detection with photutils’ image_segmentation instead)</dd>
</dl>
</li>
<li>image_registration (used in image_align_morph())</li>
</ul>
</dd>
<dt>HOTPANTS-SPECIFIC:</dt>
<dd><ul class="first last simple">
<li>hotpants (essential for image subtraction via hotpants)</li>
</ul>
</dd>
<dt>LESS ESSENTIAL DEPENDENCIES:</dt>
<dd><ul class="first last simple">
<li>astroscrappy (OPTIONAL cosmic ray rejection during background removal)</li>
</ul>
</dd>
</dl>
<p><strong>REFERENCES:</strong></p>
<dl class="docutils">
<dt>[1] Zackay, B., Ofek, E.O. Gal-Yam, A. 2016, ApJ, 830, 27</dt>
<dd><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016ApJ...830...27Z/abstract">https://ui.adsabs.harvard.edu/abs/2016ApJ…830…27Z/abstract</a></dd>
</dl>
<dl class="exception">
<dt id="amakihi.InvalidBandError">
<em class="property">exception </em><code class="descclassname">amakihi.</code><code class="descname">InvalidBandError</code><a class="headerlink" href="#amakihi.InvalidBandError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
<p>Raise this error when a template is requested in a single band/multiple
bands and none of the inputs band(s) are available for the requested
survey.</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.download_PS1_template">
<code class="descclassname">amakihi.</code><code class="descname">download_PS1_template</code><span class="sig-paren">(</span><em>ra</em>, <em>dec</em>, <em>size=2400</em>, <em>filt='grizy'</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.download_PS1_template" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>RA, Dec of interest</li>
<li>size for the image in pixels (1 pix == 0.258” in PS1; optional;
default 2400)*</li>
<li>filter(s) (g, r, i, z, y) to use (files are always downloaded
separately when multiple filters are provided; optional; default
‘grizy’)</li>
<li>output name(s) for the downloaded template(s) (optional; defaults
set below)</li>
</ul>
</dd>
</dl>
<p>Downloads the relevant PS1 template image(s) at the input RA, Dec.</p>
<ul class="simple">
<li>size must be an int, will be converted if not</li>
</ul>
<p>Output: HDU object(s) for the downloaded template image(s)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.download_DECaLS_template">
<code class="descclassname">amakihi.</code><code class="descname">download_DECaLS_template</code><span class="sig-paren">(</span><em>ra</em>, <em>dec</em>, <em>size=512</em>, <em>pixscale=0.262</em>, <em>filt='grz'</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.download_DECaLS_template" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>RA, Dec of interest</li>
<li>size for the image in pixels* (1 pixel == 0.262” in native DECam
resolution, but this resolution can be adjusted; optional; default
512)</li>
<li>scale (resolution) of the image in arcseconds per pixel (optional;
default 0.262)</li>
<li>filter(s) (g, r, z) to use (files are always downloaded separately
when multiple filters are provided; optional; default ‘grz’)</li>
<li>output name(s) for the downloaded template(s)</li>
</ul>
</dd>
</dl>
<p>Downloads the relevant DECaLS template image(s) at the input RA, Dec.</p>
<ul class="simple">
<li>size must be an int &lt;= 512 , will be converted if not</li>
</ul>
<p>Output: HDU object(s) for the downloaded template image(s)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.download_CFIS_template">
<code class="descclassname">amakihi.</code><code class="descname">download_CFIS_template</code><span class="sig-paren">(</span><em>ra</em>, <em>dec</em>, <em>size=1600</em>, <em>filt='ur'</em>, <em>auth_user='nvieira97'</em>, <em>auth_pass='iwtg2s'</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.download_CFIS_template" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>RA, Dec of interest</li>
<li>size for the image in pixels (1 pix == 0.185” in CFIS; optional;
default 1600)</li>
<li>filter(s) (u, r) desired (files are always downloaded separately
when multiple filters are provided; optional; default ‘ur’)</li>
<li>CADC username, password needed to download CFIS data (optional;
login is set by default)</li>
</ul>
</dd>
</dl>
<p>Downloads the relevant CFIS template image(s) at the input RA, Dec.</p>
<p>Output: HDU object(s) for the downloaded template image(s)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.download_2MASS_template">
<code class="descclassname">amakihi.</code><code class="descname">download_2MASS_template</code><span class="sig-paren">(</span><em>ra</em>, <em>dec</em>, <em>size=150</em>, <em>filt='A'</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.download_2MASS_template" title="Permalink to this definition">¶</a></dt>
<dd><p>Input: a RA, Dec of interest, a size for the image in pixels (1 pix ==
4.0” in 2MASS), and the filter(s) (A for all or J, H, K) desired</p>
<p>Downloads the relevant 2MASS template image(s) at the input RA, Dec.</p>
<p>Output: HDU object(s) for the downloaded template image(s)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.get_templates">
<code class="descclassname">amakihi.</code><code class="descname">get_templates</code><span class="sig-paren">(</span><em>images</em>, <em>survey='PS1'</em>, <em>outputs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.get_templates" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>directory containing image file(s) for which to download a template,
OR a list of files</li>
<li>survey of interest (optional; default ‘PS1’; current options are
‘PS1’, ‘CFIS’)</li>
<li>output filename(s) (optional; defaults set below)</li>
</ul>
</dd>
</dl>
<p>For a directory full of images, downloads a corresponding template from the
requested survey, if possible.</p>
<p>Output: None</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.crop_WCS">
<code class="descclassname">amakihi.</code><code class="descname">crop_WCS</code><span class="sig-paren">(</span><em>source_file</em>, <em>ra</em>, <em>dec</em>, <em>size</em>, <em>mode='truncate'</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.crop_WCS" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>fits filename</li>
<li>right ascension, declination (in decimal degrees)</li>
<li>size of a box (in pixels) to crop</li>
<li>mode to apply if the requested crop lies outside of image bounds:
“truncate” to truncate the crop and return a crop smaller than the
requested one; “extend” to extend the bounds of the image in the
direction opposite the exceeded boundary, effectively recentering the
crop (optional; default “truncate”)</li>
<li>whether to write the output to a .fits file (optional; default True)</li>
<li>name for the output fits file (optional; default set below)</li>
</ul>
</dd>
</dl>
<p>For a single fits file, crops the image to a box of size pixels centered
on the given RA and Dec. If the given box extends beyond the bounds of the
image, the box will either be truncated at these bounds or re-centered to
allow for a box of the requested size, depending on the input mode.</p>
<p>Output: a PrimaryHDU for the cropped image (contains data and header)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.crop_frac">
<code class="descclassname">amakihi.</code><code class="descname">crop_frac</code><span class="sig-paren">(</span><em>source_file, frac_hori=[0, 1], frac_vert=[0, 1], write=True, output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.crop_frac" title="Permalink to this definition">¶</a></dt>
<dd><p>Input: the horizontal fraction of the fits file’s
image to crop (default [0,1], which does not crop), the vertical fraction
(default [0,1]), a bool indicating whether to save write the output .fits
file (optional; default True) and a name for the output fits file
(optional; default is set below)</p>
<p>Output: a PrimaryHDU for the cropped image (contains data and header)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.crop_octant">
<code class="descclassname">amakihi.</code><code class="descname">crop_octant</code><span class="sig-paren">(</span><em>source_file</em>, <em>ra</em>, <em>dec</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.crop_octant" title="Permalink to this definition">¶</a></dt>
<dd><p>Input: the name of the fits file, a right ascension, declination (in
decimal degrees), whether to write the output fits file (optional;
default True) and the name for the output fits file (optional; default set
below)</p>
<p>For a given, RA, Dec, finds the octant-sized ~square of the image in which
these coords are found. Then crops the image to this octant. Best for
images with an aspect ratio of around 2:1 (i.e. MegaCam images) such that
the output crop is square-like.</p>
<p>Output: a PrimaryHDU for the cropped image (contains data and header)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.crop_half">
<code class="descclassname">amakihi.</code><code class="descname">crop_half</code><span class="sig-paren">(</span><em>source_file</em>, <em>ra</em>, <em>dec</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.crop_half" title="Permalink to this definition">¶</a></dt>
<dd><p>Input: the name of the fits file, a right ascension, declination (in
decimal degrees), whether to write the output fits file (optional;
default True) and the name for the output fits file (optional; default set
below)</p>
<p>For a given, RA, Dec, finds the half of the image in which these coords
are found. This can be the top half, bottom half, or a box centered on the
center of the overall image. Then crops the image. Best for images with an
aspect ratio of around 2:1 (i.e. MegaCam images) such that the output crop
is square-like.</p>
<p>Output: a PrimaryHDU for the cropped image (contains data and header)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.bkgsub">
<code class="descclassname">amakihi.</code><code class="descname">bkgsub</code><span class="sig-paren">(</span><em>im_file</em>, <em>mask_file=None</em>, <em>bkg_box=(5</em>, <em>5)</em>, <em>bkg_filt=(5</em>, <em>5)</em>, <em>crreject=False</em>, <em>plot_bkg=False</em>, <em>scale_bkg=None</em>, <em>plot=False</em>, <em>scale=None</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.bkgsub" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>image of interest</li>
<li>bad pixels mask (optional; default None)</li>
<li>size of the box along each axis for background estimation (optional;
default (5,5))</li>
<li>size of the median filter pre-applied to the background before
estimation (optional; default (5,5); (1,1) indicates no filtering)</li>
<li>whether to plot the background (optional; default False)</li>
<li>scale to apply to the background plot (optional; default None
(linear);  options are “linear”, “log”, “asinh”)</li>
<li>whether to plot the background-SUBTRACTED image (optional; default
False)</li>
<li>scale to apply to the background-SUBTRACTED image (optional; default
None (linear);  options are “linear”, “log”, “asinh”)</li>
<li>whether to write the background-subtracted image (optional; default
True)</li>
<li>name for the output background-subtracted image in a FITS file
(optional; default set below)</li>
</ul>
</dd>
</dl>
<p>Performs background subtraction on the input image.</p>
<p>Output: the background-subtracted image data in a fits HDU</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.image_align">
<code class="descclassname">amakihi.</code><code class="descname">image_align</code><span class="sig-paren">(</span><em>source_file</em>, <em>template_file</em>, <em>mask_file=None</em>, <em>imsegm=True</em>, <em>astrometry=False</em>, <em>doublealign=False</em>, <em>per_upper=0.95</em>, <em>exclusion=0.05</em>, <em>nsources=50</em>, <em>thresh_sigma=3.0</em>, <em>pixelmin=10</em>, <em>etamax=2.0</em>, <em>bkgsubbed=False</em>, <em>astrom_sigma=8.0</em>, <em>psf_sigma=5.0</em>, <em>keep=False</em>, <em>sep_max=2.0</em>, <em>ncrossmatch=8</em>, <em>wcs_transfer=True</em>, <em>plot_sources=False</em>, <em>plot_align=None</em>, <em>scale=None</em>, <em>circ_color='#fe01b1'</em>, <em>write=True</em>, <em>output_im=None</em>, <em>output_mask=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.image_align" title="Permalink to this definition">¶</a></dt>
<dd><p>WIP: during transfer of WCS header from PS1 to CFHT, WCS becomes nonsense</p>
<dl class="docutils">
<dt>Input:</dt>
<dd><p class="first">general:
- science image (source) to register
- template image (target) to match source to
- mask file for the SOURCE image (optional; default None)</p>
<p>source detection:
- use image segmentation for source detection and provide astroalign</p>
<blockquote>
<div>with a list of x, y coordinates if True (optional; default True)</div></blockquote>
<ul class="simple">
<li>use astrometry.net (specifically, image2xy) for source detection and
provide astroalign with a list of x, y coordinates if True (optional;
default False; overriden by imsegm if imsegm=True)</li>
<li>attempt a second, more refined alignment by cross-matching sources
from the two images and using the correspondence to build a new
transform (optional; default False)</li>
<li>flux percentile upper limit (optional; default 0.95 = 95%; can be
set to a list to specify different values for science and template
images)</li>
<li>no. of sources to keep for asterism-matching (optional; default 50;
astroalign will not accept any more than 50)</li>
<li>the fraction of the top/bottom/left/right-most edges from which to
exclude sources during matching (optional; default 0.05; can be
set to a list to specify different values for science and
template images)</li>
</ul>
<p>if imsegm=True (default):
- sigma threshold for source detection with image segmentation</p>
<blockquote>
<div>(optional; default 3.0; can pass a list to specify a different
threshold for source and template)</div></blockquote>
<ul class="simple">
<li><em>minimum</em> number of isophote pixels, i.e. area (optional; default 10;
can pass a list to specify a different area for source and template)</li>
<li><em>maximum</em> allowed elongation for sources found by image segmentation
(optional; default 2.0; setting this to None sets no maximum;
can pass a list to specify different maximum elongation for source
and template)</li>
</ul>
<p>if astrometry=True (and imsegm=False):
- whether the input source and template files have been background-</p>
<blockquote>
<div>subtracted (optional; default False; can be set to a list to specify
that the science image is background-subtracted and the template is
not or vice-versa)</div></blockquote>
<ul class="simple">
<li>sigma threshold for image2xy source detection in the source/template
(optional; default 8.0 which sets the threshold to 8.0 for both; can
pass a list to specify a different threshold for source and template)</li>
<li>the sigma of the Gaussian PSF of the source/template (optional;
default 5.0 which sets the sigma to 5.0 for both; can pass a list to
specify a different width for source and template)</li>
<li>whether to keep the source list files after running image2xy
(optional; default False)</li>
</ul>
<p>if doublealign=True (and imsegm=True):
- maximum allowed on-sky separation (in arcsec) to cross-match a source</p>
<blockquote>
<div>in the science image and another in the template (optional; default
2.0”)</div></blockquote>
<ul class="simple">
<li>required no. of cross-matched sources to do double alignment
(optional; default 8)</li>
</ul>
<p>transferring WCS:
- whether to try transferring the WCS solution of the template image</p>
<blockquote>
<div>to the science image (optional; default True)</div></blockquote>
<p>plotting:
- whether to plot the sources detected in the science image and</p>
<blockquote>
<div>and template image, if astrometry was used (optional; default False)</div></blockquote>
<ul class="simple">
<li>whether to plot the aligned image data (optional; default False)</li>
<li>scale to apply to the plot(s) (optional; default None (linear);
options are “linear”, “log”, “asinh”)</li>
<li>color for the circles around the sources in the source detection
image (optional; default “#fe01b1” ~ bright pink; only relevant if
plot_sources=True)</li>
</ul>
<p>writing:
- whether to write the outputs to .fits files (optional; default True)
- names for the output aligned image and image mask (both optional;</p>
<blockquote class="last">
<div>defaults set below)</div></blockquote>
</dd>
</dl>
<p>Uses either image segmentation (default) or astrometry.net’s image2xy to
find a set of x, y control points in the source and target images. Then,
- excludes sources very close to the border as set by the user
- if using image segmentation, imposes a minimum isophote area and maximum</p>
<blockquote>
<div>source elongation for each source</div></blockquote>
<ul class="simple">
<li>rejects sources above some upper flux percentile as set by the user</li>
<li>selects as many sources as possible (maximum set by user, can not exceed
50) as control points</li>
</ul>
<p>These control points are then passed to astroalign, which finds the
invariants between the source control point set and target control point
set to compute the affine transformation which aligns the source image with
the target image. Applies this transformation to the science image.</p>
<p>Alternatively, can allow astroalign to do all of the above steps on its own
with no supervision.</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>* Uses a slightly modified version of astroalign.</p>
<p>NOTE: image2xy has a hard time doing basic background subtraction when an
image has nans in it. Before trying alignment with an image which contains
nans, it is suggested to set all nans to 0 instead.</p>
<p>Output: the aligned image and a bad pixel mask</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.image_align_morph">
<code class="descclassname">amakihi.</code><code class="descname">image_align_morph</code><span class="sig-paren">(</span><em>source_file</em>, <em>template_file</em>, <em>mask_file=None</em>, <em>flip=False</em>, <em>maxoffset=30.0</em>, <em>wcs_transfer=True</em>, <em>plot=False</em>, <em>scale=None</em>, <em>write=True</em>, <em>output_im=None</em>, <em>output_mask=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.image_align_morph" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>WIP: WCS header of aligned image doesn’t always seem correct for alignment</dt>
<dd>with non-CFHT templates</dd>
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>science image (source) to register</li>
<li>template image (target) to match source to</li>
<li>mask file for the SOURCE image (optional; default None)</li>
<li>whether to flip the image (invert along X and Y) before tying to
align (optional; default False)</li>
<li>maximum allowed pixel offset before deciding that alignment is not
accurate (optional; default 30.0 pix)</li>
<li>whether to plot the matched image data (optional; default False)</li>
<li>scale to apply to the plot (optional; default None (linear); options
are “linear”, “log”, “asinh”)</li>
<li>whether to write the output to .fits files (optional; default True)</li>
<li>name for output aligned image file (optional; default set below)</li>
<li>name for output mask image file (optional; default set below)</li>
</ul>
</dd>
</dl>
<p>Input: the science image (the source), the template to match to, a mask of
bad pixels to ignore (optional; default None), a bool indicating whether to
flip (invert along x AND y) the image before trying to align (optional;
default False), the maximum allowed offset before deciding
that the alignment is not accurate (optional; default 30.0 pix), a bool
indicating whether to plot the matched image data (optional; default
False), a scale to apply to the plot (optional; default None (linear);
options are “linear”, “log”, “asinh”), whether to write output .fits to
files (optional; default True) and names for the output aligned image and
image mask (both optional; defaults set below)</p>
<p>Calls on image_registration to align the source image with the target to
allow for proper image subtraction. Also finds a mask of out of bounds
pixels to ignore during subtraction. The image registration in this
function is based on morphology and edge detection in the image, in
contrast with image_align, which uses asterism-matching to align the two
images.</p>
<p>For images composed mostly of point sources, use image_align. For images
composed mainly of galaxies/nebulae and/or other extended objects, use this
function.</p>
<p>Output: the aligned image and a bad pixel mask</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.solve_field">
<code class="descclassname">amakihi.</code><code class="descname">solve_field</code><span class="sig-paren">(</span><em>image_file</em>, <em>remove_PC=True</em>, <em>verify=False</em>, <em>prebkgsub=False</em>, <em>guess_scale=False</em>, <em>read_scale=True</em>, <em>pixscale=None</em>, <em>scale_tolerance=0.05</em>, <em>verbose=0</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.solve_field" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><p class="first">general:
- image file to solve with astrometry.net’s solve-field
- whether to look for PC00i00j headers and remove them in the image</p>
<blockquote>
<div>before solving, if present (optional; default True)</div></blockquote>
<ul class="simple">
<li>try to verify WCS headers when solving (optional; default False)</li>
<li>whether input file is previously background-subtracted (optional;
default False)</li>
</ul>
<p>pixel scale:
- try to guess the scale of the image from WCS headers (optional;</p>
<blockquote>
<div>default False)</div></blockquote>
<ul>
<li><p class="first">whether to search the headers for a PIXSCAL1 header containing the
image pixel scale (optional; default True)
will be ignored if guess_scale=True</p>
</li>
<li><p class="first">image scale (in arcsec per pixel), if known (optional; default None)
will be ignored unless :</p>
<blockquote>
<div><p>guess_scale=False AND read_scale=True AND no header “PIXSCAL1”,
OR guess_scale=False AND read_scale=False</p>
</div></blockquote>
</li>
<li><p class="first">degree of +/- tolerance for the pixel scale of the image, if the
header PIXSCAL1 is found in the image file OR if a scale is given
(optional; default 0.05 arcsec per pix)
e.g., if hdr[“PIXSCAL1”] = 0.185, astrometry.net will only look for
solutions with a pixel scale of 0.185 +/- 0.05 arcsec per pix by
default
or, if this header is not found OR read_scale=False AND scale=0.185,
the same</p>
</li>
</ul>
<p class="last">other:
- level of verbosity (optional; default 0; options are 0, 1, 2)
- name for output updated .fits file (optional; default set below)</p>
</dd>
</dl>
<p>NOTE: the output filename MUST be different from the input filename.
astrometry.net will exit if this is not the case.</p>
<p>Output: the STDOUT from solve-field, as text</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.box_mask">
<code class="descclassname">amakihi.</code><code class="descname">box_mask</code><span class="sig-paren">(</span><em>image_file</em>, <em>pixx</em>, <em>pixy</em>, <em>mask_file=None</em>, <em>plot=False</em>, <em>write=True</em>, <em>output=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.box_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Input: image file, the x pixel range and y pixel range to mask, an
already existing mask file to combine with the new box mask (optional;
default None), whether to plot the mask (optional; default False), whether
to write the mask file (optional; default True), and the name for the
output mask file (optional; default set below)</p>
<p>Creates a simple box-shaped mask delimited by (pixx[0],pixx[1]) and
(pixy[0],pixy[1]). If an existing mask is supplied, the output mask will be
a combination of the previous mask and the box mask.</p>
<p>Output: the mask file HDU</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.saturation_mask">
<code class="descclassname">amakihi.</code><code class="descname">saturation_mask</code><span class="sig-paren">(</span><em>image_file</em>, <em>mask_file=None</em>, <em>sat_ADU=40000</em>, <em>sat_area_min=500</em>, <em>ra_safe=None</em>, <em>dec_safe=None</em>, <em>rad_safe=None</em>, <em>dilation_its=5</em>, <em>blursigma=2.0</em>, <em>write=True</em>, <em>output=None</em>, <em>plot=True</em>, <em>plotname=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.saturation_mask" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>image file</li>
<li>a mask file to merge with the created saturation mask (optional;
default None)</li>
<li>saturation ADU above which all pixels will be masked (optional;
default 40000, which is a bit below the limit for MegaCam)</li>
<li><em>minimum</em> and maximum areas in square pixels for a saturated source
(optional; default 500 and 100000, respectively)</li>
<li>the RA (deg), DEC (deg), and radius (arcsec) denoting a “safe zone”
in which no sources will be masked (optional; defaults are None)</li>
<li>the number of iterations of binary dilation to apply to the mask,
where binary dilation is a process which “dilates” the detected
sources to make sure all pixels are adequately masked (optional;
default 5)</li>
<li>sigma of the gaussian filter to apply to the mask to blur it
(optional; default 2.0)</li>
<li>whether to write the mask file (optional; default True)</li>
<li>name for the output mask file (optional; default set below)</li>
<li>whether to plot the mask in greyscale (optional; default True)</li>
<li>name for the output plot (optional; default set below; only relevant
if plot=True)</li>
</ul>
</dd>
</dl>
<p>Uses image segmentation to find all sources in the image. Then, looks for
sources which have a maximum flux above the saturation ADU and within the
minimum and maximum saturation area and creates a mask of these sources.
Binary dilation is applied to to enlarge features in the mask and Gaussian
blurring is applied to smooth out the mask.</p>
<p>If a “safe zone” is supplied, any sources within the safe zone will be
labelled as NON-saturated. This is useful if you know the coordinates of
some galaxy/nebulosity in your image which should not be masked, as it is
sometimes difficult to distinguish between a saturated source and a galaxy.</p>
<p>If an existing mask is supplied, the output mask will be a combination of
the previous mask and saturation mask.</p>
<p>Output: a table of source properties and the mask file HDU</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.ePSF_FWHM">
<code class="descclassname">amakihi.</code><code class="descname">ePSF_FWHM</code><span class="sig-paren">(</span><em>epsf_data</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.ePSF_FWHM" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>fits file containing ePSF data OR the data array itself</li>
<li>be verbose (optional; default False)</li>
</ul>
</dd>
</dl>
<p>Output: the FWHM of the input ePSF</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.build_ePSF">
<code class="descclassname">amakihi.</code><code class="descname">build_ePSF</code><span class="sig-paren">(</span><em>image_file</em>, <em>mask_file=None</em>, <em>nstars=40</em>, <em>astrometry=False</em>, <em>thresh_sigma=5.0</em>, <em>pixelmin=20</em>, <em>etamax=1.4</em>, <em>area_max=500</em>, <em>image_source_file=None</em>, <em>astrom_sigma=5.0</em>, <em>psf_sigma=5.0</em>, <em>alim=10000</em>, <em>lowper=60</em>, <em>highper=90</em>, <em>clean=True</em>, <em>cutout=35</em>, <em>write=True</em>, <em>output=None</em>, <em>plot=False</em>, <em>output_plot=None</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.build_ePSF" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><p class="first">general:
- filename for a <strong>BACKGROUND-SUBTRACTED</strong> image
- filename for a mask image (optional; default None)
- maximum number of stars to use (optional; default 40; set to None</p>
<blockquote>
<div>to impose no limit)</div></blockquote>
<p>source detection:
- use astrometry.net for source detection if True, use simple image</p>
<blockquote>
<div><p>segmentation to detect sources if False (optional; default False)</p>
<p>if astrometry = False (default):</p>
</div></blockquote>
<ul>
<li><p class="first">sigma threshold for source detection with image segmentation
(optional; default 5.0)</p>
</li>
<li><p class="first"><em>minimum</em> number of isophotal pixels (optional; default 20)</p>
</li>
<li><p class="first"><em>maximum</em> allowed elongation for sources found by image segmentation
(optional; default 1.4)</p>
</li>
<li><p class="first"><em>maximum</em> allowed area for sources found by image segmentation
(optional; default 500 pix**2)</p>
<p>if astrometry=True:</p>
</li>
<li><p class="first">filename for a .xy.fits file containing detected sources with their
x, y coords and <strong>BACKGROUND-SUBTRACTED</strong> fluxes (optional; default
None, in which case a new list will be made)</p>
</li>
<li><p class="first">sigma threshold for astrometry.net source detection image (optional;
default 5.0)</p>
</li>
<li><p class="first">sigma of the Gaussian PSF of the image (optional; default 5.0)</p>
</li>
<li><p class="first">maximum allowed source area in pix**2 for astrometry.net for
deblending (optional; default 10000)</p>
</li>
<li><p class="first">LOWER flux percentile such that sources below this flux will be
rejected when building the ePSF (optional; default 60 [%])</p>
</li>
<li><p class="first">UPPER flux percentile such that sources above this flux will be
rejected when building the ePSF (optional; default 90 [%])</p>
</li>
<li><p class="first">whether to remove files output by image2xy once finished with them
(optional; default True)</p>
</li>
<li><p class="first">cutout size around each star in pix (optional; default 35 pix; must
be ODD, rounded down if even)</p>
</li>
</ul>
<p class="last">writing, plotting, verbosity:
- whether to write the ePSF to a new fits file (optional; default True)
- name for the output fits file (optional; default set below)
- whether to plot the ePSF (optional; default False)
- name for the output plot (optional; default set below)
- be verbose (optional; default False)</p>
</dd>
</dl>
<p>Uses image segmentation OR astrometry.net to obtain a list of sources in
the image with their x, y coordinates, flux, and background at their
location. (If a list of sources has already been obtained with astrometry,
this can be input). If astrometry is used for source detetion, then selects
stars between the &lt;lowper&gt;th and &lt;highper&gt;th percentile flux.</p>
<p>Finally, uses EPSFBuilder to empirically obtain the ePSF of these stars.
Optionally writes and/or plots the obtaind ePSF.</p>
<p>The ePSF obtained here should NOT be used in convolutions. Instead, it can
serve as a tool for estimating the seeing of an image.</p>
<p>Output: the ePSF data array</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.convolve_self">
<code class="descclassname">amakihi.</code><code class="descname">convolve_self</code><span class="sig-paren">(</span><em>image_file</em>, <em>mask_file=None</em>, <em>thresh_sigma=5.0</em>, <em>pixelmin=20</em>, <em>etamax=1.4</em>, <em>area_max=500</em>, <em>cutout=35</em>, <em>verbose=True</em>, <em>psf_fwhm_max=7.0</em>, <em>kernel='gauss'</em>, <em>alpha=1.5</em>, <em>print_new_epsf=False</em>, <em>write=True</em>, <em>output=None</em>, <em>plot=False</em>, <em>output_plot=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.convolve_self" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first simple">
<li>science image</li>
<li>mask image (optional; default None)</li>
</ul>
<p>args to pass to build_ePSF(see above)
…
…
- maximum allowed ePSF FWHM (pix); if FWHM is larger than this value</p>
<blockquote>
<div>the function will exit (optional; default 7.0 pix)</div></blockquote>
<ul class="last simple">
<li>type of kernel to build using ePSF (optional; default ‘gauss’;
options are ‘gauss’ and ‘moffat’)</li>
<li>alpha parameter (power) for the Moffat kernel (optional; default 1.5,
only relevant if kernel=’moffat’)</li>
<li></li>
<li>whether to write the output image (optional; default True)</li>
<li>output filename (optional; default set below)</li>
<li>whether to plot the output image (optional; default False)</li>
<li>output plot filename (optional; default set below)</li>
</ul>
</dd>
</dl>
<p>Finds the ePSF of the input image and finds the FWHM (and thus sigma) of
the ePSF. Then builds a Gaussian with this sigma and convolves the science
image with the Gaussian, OR builds a Moffat distribution with half the ePSF
FWHM as the core width and convolves the image with the Moffat.</p>
<p>Effectively tries to increase the size of the image’s ePSF by ~sqrt(2).
Useful as a preparation for image differencing when sigma_template &gt;
sigma_science.</p>
<p>Output: PrimaryHDU for the science image convolved with the kernel</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.hotpants_path">
<code class="descclassname">amakihi.</code><code class="descname">hotpants_path</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.hotpants_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Input: a path to the hotpants executable
Output: None</p>
<p>A bandaid fix for when I haven’t correctly setup my paths to find hotpants
on the command line. Can explicitly set the path here.</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.get_substamps">
<code class="descclassname">amakihi.</code><code class="descname">get_substamps</code><span class="sig-paren">(</span><em>source_file</em>, <em>template_file</em>, <em>sci_mask_file=None</em>, <em>tmp_mask_file=None</em>, <em>sigma=3.0</em>, <em>etamax=2.0</em>, <em>area_max=400.0</em>, <em>sep_max=5.0</em>, <em>coords='mean'</em>, <em>output=None</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.get_substamps" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>science image (the source)</li>
<li>template to match to</li>
<li>mask of bad pixels in science image (optional; default None)</li>
<li>mask of bad pixels in template image (optional; default None)</li>
<li>sigma to use in setting the threshold for image segmentation
(optional; default 3.0)</li>
<li>maximum elongation allowed for the sources (optional; default 2.0)</li>
<li>maximum pixel area allowed for the sources (optional; default 400.0
pix**2)</li>
<li>maximum allowed separation for sources to be designated as common to
both the science image and template image, in arcsec (optional;
default 5.0”)</li>
<li>coordinate system for output (optional; default ‘mean’ of science and
template; options are ‘mean’, ‘source’, ‘template’)</li>
<li>name for the output ascii txt file of substamps ‘x y’ (optional;
default set below)</li>
<li>whether to be verbose (optional; default False)</li>
</ul>
</dd>
</dl>
<p>For both the science and template image, finds sources via image
segmentation and selects those which are not overly elongated (to filter
out galaxies) or overly large (to filter out saturated stars). Then
compares the science and template images, finds sources in common, and
writes these to an ascii text file of the form
‘x1 y1’
‘x2 y2’
‘x3 y3’</p>
<blockquote>
<div>…</div></blockquote>
<dl class="docutils">
<dt>Output:</dt>
<dd><ul class="first last simple">
<li>properties of all sources which were detected in both the science and
template image, as obtained by image segmentation</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="amakihi.param_estimate">
<code class="descclassname">amakihi.</code><code class="descname">param_estimate</code><span class="sig-paren">(</span><em>source_file</em>, <em>template_file</em>, <em>mask_file=None</em>, <em>source_epsf_file=None</em>, <em>tmp_epsf_file=None</em>, <em>thresh_sigma=3.0</em>, <em>pixelmin=20</em>, <em>etamax=1.4</em>, <em>area_max=400</em>, <em>cutout=35</em>, <em>verbose=True</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.param_estimate" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>WIP:</dt>
<dd><ul class="first last simple">
<li>Not stable right now; messes up when science and reference have
very similar PSFs (which is often the case)</li>
</ul>
</dd>
<dt>Inputs:</dt>
<dd><p class="first">general:
- science image
- template image
- mask image (optional; default None)
- source ePSF in fits file (optional; default None, in which case the</p>
<blockquote>
<div>ePSF is obtained)</div></blockquote>
<ul class="last simple">
<li>template ePSF in fits file (optional; default None, in which case the
ePSF is obtained)
…
…
args to pass to build_ePSF [see above]
…
…</li>
<li>be verbose (optional; default False)</li>
</ul>
</dd>
</dl>
<p>Given some science and template image, determines the optimal parameters
to pass to hotpants for successful subtraction.</p>
<dl class="docutils">
<dt>Outputs:</dt>
<dd><ul class="first last simple">
<li>whether to convolve the image or template</li>
<li>estimate 3 Gaussian terms with polynomial orders (as a dictionary)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="amakihi.hotpants">
<code class="descclassname">amakihi.</code><code class="descname">hotpants</code><span class="sig-paren">(</span><em>source_file</em>, <em>template_file</em>, <em>sci_mask_file=None</em>, <em>tmp_mask_file=None</em>, <em>substamps_file=None</em>, <em>param_estimate=False</em>, <em>iu=None</em>, <em>tu=None</em>, <em>il=None</em>, <em>tl=None</em>, <em>lsigma=5.0</em>, <em>hsigma=5.0</em>, <em>gd=None</em>, <em>ig=None</em>, <em>ir=None</em>, <em>tg=None</em>, <em>tr=None</em>, <em>ng=None</em>, <em>rkernel=10</em>, <em>nrx=1</em>, <em>nry=1</em>, <em>nsx=10</em>, <em>nsy=10</em>, <em>nss=3</em>, <em>rss=None</em>, <em>ssig=3.0</em>, <em>norm='i'</em>, <em>convi=False</em>, <em>convt=False</em>, <em>bgo=0</em>, <em>ko=1</em>, <em>output=None</em>, <em>mask_write=False</em>, <em>conv_write=False</em>, <em>kern_write=False</em>, <em>noise_write=False</em>, <em>noise_scale_write=False</em>, <em>maskout=None</em>, <em>convout=None</em>, <em>kerout=None</em>, <em>noiseout=None</em>, <em>noisescaleout=None</em>, <em>v=1</em>, <em>log=None</em>, <em>plot=True</em>, <em>plotname=None</em>, <em>scale=None</em>, <em>target=None</em>, <em>target_small=None</em>, <em>thresh_sigma=3.0</em>, <em>pixelmin=20</em>, <em>etamax=1.4</em>, <em>area_max=500</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.hotpants" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>hotpants args OR hotpants-related:</dt>
<dd><p class="first">basic inputs:
- the science image
- the template to match to
- a mask of which pixels to ignore in the science image (optional;</p>
<blockquote>
<div>default None)</div></blockquote>
<ul class="simple">
<li>a mask of which pixels to ignore in the template image (optional;
default None)</li>
<li>a text file containing the substamps ‘x y’ (optional; default None)</li>
<li>whether to compare the science and template ePSFS to estimate the
optimal Gaussian terms, convolution kernel half width, substamp FWHM
to extract around stars, and whether to convolve the science image or
template (optional; default False; overrides the following parameters
if True: ng, rkernel, convi, convt)</li>
</ul>
<p>ADU limits:
- the upper (u) and lower (l) ADU limits for the image (i) and</p>
<blockquote>
<div>template (t) (optional; defaults set below by lsigma/hsigma)</div></blockquote>
<ul class="simple">
<li>no. of std. devs away from background at which to place the LOWER
ADU limit (optional; default 5.0)</li>
<li>no. of std. devs away from background at which to place the UPPER
ADU limit (optional; default 5.0)</li>
</ul>
<p>good pixels:
- good pixels coordinates (optional; default is full image)</p>
<blockquote>
<div>format: xmin xmax ymin ymax
e.g. gd=”150 1000 200 800”</div></blockquote>
<p>gain, noise:
- the gain (g) and readnoise (r) for the image (i) and template (t)</p>
<blockquote>
<div>(optional; default is to extract from headers or set gain=1, noise=0
if no relevant headers are found)</div></blockquote>
<p>Gaussian terms:
- gaussian terms (optional; default set below)</p>
<blockquote>
<div>format: ngauss degree0 sigma0 … degreeN sigmaN, N=ngauss-1
e.g. 3 6.0 0.7 4.0 1.5 2.0 3.0 (default)
where ngauss is the no. of gaussians which compose the kernel,
degreeI is the degree of the Ith polynomial, and sigmaI is the
width of the Ith gaussian</div></blockquote>
<p>convolution kernel:
- convolution kernel FWHM (optional; default is 10.0)</p>
<p>regions, stamps and substamps:
- no. of regions in x direction (optional; default 1)
- no. of regions in y direction (optional; default 1)
- no. of stamps in each region in x direction (optional; default 10)
- no. of stamps in each region in y direction (optional; default 10)
- no. of centroids to extract from each stamp (optional; default 3)
- half width of substamp around centroids (optional; default is 2.5*</p>
<blockquote>
<div>rkernel = 25.0 for default rkernel)</div></blockquote>
<p>sigma clipping, normalization:
- sigma threshold for sigma clipping (optional; default 3.0)
- normalization term (optional; default ‘i’ for image; options are</p>
<blockquote>
<div>‘i’ for image, ‘t’ for template, ‘u’ for unconvolved image/template)</div></blockquote>
<p>convolution of image or template:
- force convolve the image (optional; default False)
- force convolve the template (optional; default False)</p>
<p>background/kernel variation
- spatial background variation order (optional; default 0)
- spatial kernel variation order (optional; default 1)</p>
<p>outputs:
- name for the output subtracted image (optional; default set below)
- whether to output the bad pixel mask (optional; default False)
- whether to output the convolved image (optional; default False)
- whether to output the kernel image (optional; default False)
- whether to output the noise image (optional; default False)
- whether to output the noise <em>scaled difference</em> image (optional;</p>
<blockquote>
<div>default False)</div></blockquote>
<ul class="simple">
<li>name for the output bad pixel mask (optional; default set below; only
relevant if mask_write=True)</li>
<li>name for the output convolved image (optional; default set below;
only relevant if conv_write=True)</li>
<li>name for the output kernel (optional; default set below; only
relevant if kern_write=True)</li>
<li>name for the output noise image (optional; default set below; only
relevant if noise_write=True)</li>
<li>name for the output noise <em>scaled difference</em> image (optional;
default set below, only relevant if noise_scale_write=True)</li>
</ul>
<p>verbosity:
- verbosity (optional; default 1; options are 0 - 2 where 0 is least</p>
<blockquote>
<div>verbose)</div></blockquote>
<p class="last">log file:
- a name for a logfile to store STDERR (optional; default None)</p>
</dd>
<dt>other args:</dt>
<dd><ul class="first last simple">
<li>plot the subtracted image data (optional; default False)</li>
<li>name for the plot (optional; default set below)</li>
<li>scale to apply to the plot (optional; default None (linear);
options are “linear, “log”, “asinh”)</li>
<li>target Ra, Dec at which to place crosshair (optional, default None)</li>
<li>target Ra, Dec at which to place smaller crosshair (optional, default
None)</li>
</ul>
</dd>
<dt>args for build_ePSF (iff param_estimate = True):</dt>
<dd><ul class="first last simple">
<li>sigma threshold for source detection with image segmentation
(optional; default 5.0)</li>
<li><em>minimum</em> number of isophotal pixels (optional; default 20)</li>
<li><em>maximum</em> allowed elongation for sources found by image segmentation
(optional; default 1.8)</li>
<li><em>maximum</em> allowed area for sources found by image segmentation
(optional; default 500 pix**2)</li>
</ul>
</dd>
</dl>
<p>A wrapper for hotpants.</p>
<p><a class="reference external" href="https://github.com/acbecker/hotpants">https://github.com/acbecker/hotpants</a>
HOTPANTS: High Order Transformation of Psf ANd Template Subtraction
Based on &gt;&gt;&gt; Alard, C., &amp; Lupton, R. H. 1998, ApJ, 503, 325 &lt;&lt;&lt;
<a class="reference external" href="https://iopscience.iop.org/article/10.1086/305984/pdf">https://iopscience.iop.org/article/10.1086/305984/pdf</a></p>
<p>Output: the subtracted image HDU</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.transient_detect">
<code class="descclassname">amakihi.</code><code class="descname">transient_detect</code><span class="sig-paren">(</span><em>sub_file, og_file, ref_file, mask_file=None, thresh_sigma=5.0, pixelmin=20, dipole_width=2.0, dipole_fratio=5.0, etamax=1.8, area_max=300, nsource_max=50, toi=None, toi_sep_min=None, toi_sep_max=None, write=True, output=None, plot_distributions=False, plot_rejections=False, plots=['zoom og', 'zoom ref', 'zoom diff'], pixcoords=False, sub_scale=None, og_scale=None, stampsize=200.0, crosshair_og='#fe019a', crosshair_sub='#5d06e9', title=None, plotdir=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.transient_detect" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Inputs:</dt>
<dd><p class="first">general:
- subtracted image file
- original science image file (can be background-subtracted or not)
- original reference image file (can be background-subtracted or not)
- a mask file (optional; default None)</p>
<p>source detection and candidate rejection:
- sigma threshold for source detection with image segmentation</p>
<blockquote>
<div>(optional; default 3.0)</div></blockquote>
<ul class="simple">
<li><em>minimum</em> number of isophote pixels, i.e. area (optional; default 20)</li>
<li><em>maximum</em> allowed separation for any potential dipoles to be
considered real sources (optional; default 2.0”; setting this to None
sets no maximum)</li>
<li><em>maximum</em> allowed flux ratio for dipoles (optional; default 5.0)</li>
<li><em>maximum</em> allowed elongation for sources found by image segmentation
(optional; default 1.8; setting this to None sets no maximum)</li>
<li><em>maximum</em> allowed pixel area for sources (optional; default 300)</li>
<li><em>maximum</em> allowed total number of transients (optional; default 50;
setting this to None sets no maximum)</li>
<li>[ra,dec] for some target of interest (e.g., a candidate host galaxy)
such that the distance to this target will be computed for every
candidate transient (optional; default None)</li>
<li><em>minimum</em> separation between the target of interest and the transient
(optional; default None; only relevant if TOI is supplied)</li>
<li><em>maximum</em> separation between the target of interest and the transient
(optional; default None, only relevant if TOI is supplied)</li>
</ul>
<p>writing and plotting:
- whether to write the source table (optional; default True)
- name for the output source table (optional; default set below; only</p>
<blockquote>
<div>relevant if write=True)</div></blockquote>
<ul>
<li><p class="first">whether to plot the histograms of elongation, area, and a scatter
plot of elongation versus area (optional; default False)</p>
</li>
<li><p class="first">whether to plot an image showing all objects in the difference image
which did not pass candidate vetting and those which did, with
different markers indicating the reason for rejection (optional;
default False)</p>
</li>
<li><dl class="first docutils">
<dt>an array of which plots to produce, where valid options are:</dt>
<dd><ol class="first arabic simple">
<li>“full” - the full-frame subtracted image</li>
<li>“zoom og” - postage stamp of the original science image</li>
<li>“zoom ref” - postage stamp of the original reference image</li>
</ol>
<p class="last">(4) “zoom diff” - postage stamp of the subtracted image
(optional; default is [“zoom og”, “zoom ref”, “zoom diff”])</p>
</dd>
</dl>
</li>
</ul>
<p>the following are relevant only if plots are requested:
- whether to use the pixel coord
- scale to apply to the difference images (optional; default “asinh”;</p>
<blockquote>
<div>options are “linear”, “log”, “asinh”)</div></blockquote>
<ul class="last simple">
<li>scale to apply to the science/reference images (optional; default
“asinh”; options are “linear”, “log”, “asinh”)</li>
<li>size of the transient stamp in pixels (optional; default 200.0)</li>
<li>colour for crosshair on transient in science/ref images (optional;
default ~hot pink)</li>
<li>colour for crosshair on transient in difference images (optional;
default ~purple-blue)</li>
<li>a title to include in the titles of all plots AND filenames of all
plots, except the rejection plot (optional; default None)</li>
<li>name for the directory in which to store all plots (optional;
default set below)</li>
</ul>
</dd>
</dl>
<p>Looks for sources with flux &gt; sigma*std, where std is the standard
deviation of the good pixels in the subtracted image. Sources must also be
made up of at least pixelmin pixels. From these, selects sources below some
elongation limit to try to prevent obvious residuals from being detected as
sources. For each candidate transient source, optionally plots the full
subtracted image and “postage stamps” of the transient on the original
science image, reference image and/or subtracted image.</p>
<p>Output: a table of sources with their properties (coordinates, area,
elongation, separation from a target of interest (if relevant), etc.)</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.transient_plot">
<code class="descclassname">amakihi.</code><code class="descname">transient_plot</code><span class="sig-paren">(</span><em>sub_file, og_file, ref_file, tbl, pixcoords=False, toi=None, plots=['zoom og', 'zoom ref', 'zoom diff'], sub_scale=None, og_scale=None, stampsize=200.0, crosshair_og='#fe019a', crosshair_sub='#5d06e9', title_append=None, plotdir=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.transient_plot" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Inputs:</dt>
<dd><p class="first">general:￼
- difference image file
- original science image file (can be background-subtracted or not)
- original reference image file (can be background-subtracted or not)
- a table of candidate transient source(s) found with</p>
<blockquote>
<div>transient_detect() or some other tool (can be the name of a table
file or the table itself)
note: if pixcoords=False, the table must have at least the columns
“ra” and “dec”; if pixcoords=True, the table must have at least the
columns “xcentroid” and “ycentroid”</div></blockquote>
<ul class="simple">
<li>whether to use the pixel coordinates of the transients when plotting
rather than the ra, dec (optional; default False; recommended to use
in cases where it is not clear that the WCS of the science and
reference images matches exactly)</li>
<li>[ra,dec] for some target of interest (e.g., a candidate host galaxy)
such that a crosshair is also plotted at its location (optional;
default None)</li>
</ul>
<p>plotting specifics:
- an array of which plots to produce, where valid options are:</p>
<blockquote>
<div><ol class="arabic simple">
<li>“full” - the full-frame subtracted image</li>
<li>“zoom og” - postage stamp of the original science image</li>
<li>“zoom ref” - postage stamp of the original reference image</li>
</ol>
<p>(4) “zoom diff” - postage stamp of the subtracted image
(optional; default is [“zoom og”, “zoom ref”, “zoom diff”])</p>
</div></blockquote>
<ul class="last simple">
<li>scale to apply to the difference images (optional; default “asinh”;
options are “linear”, “log”, “asinh”)</li>
<li>scale to apply to the science/reference images (optional; default
“asinh”; options are “linear”, “log”, “asinh”)</li>
<li>size of the transient stamp in pixels (optional; default 200.0)</li>
<li>colour for crosshair on transient in science/ref images (optional;
default hot pink)</li>
<li>colour for crosshair on transient in difference images (optional;
default purple-blue)</li>
<li>a title to include in all plots AND all filenames for the plots
(optional; default None)</li>
<li>name for the directory in which to store all plots (optional;
default set below)</li>
</ul>
</dd>
</dl>
<p>Output: None</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.transient_triplets">
<code class="descclassname">amakihi.</code><code class="descname">transient_triplets</code><span class="sig-paren">(</span><em>sub_file</em>, <em>og_file</em>, <em>ref_file</em>, <em>tbl</em>, <em>pixcoords=False</em>, <em>size=200</em>, <em>cropmode='extend'</em>, <em>write=True</em>, <em>output=None</em>, <em>plot=False</em>, <em>wide=True</em>, <em>cmap='bone'</em>, <em>title=None</em>, <em>plotdir=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.transient_triplets" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Inputs:</dt>
<dd><ul class="first simple">
<li>difference image file</li>
<li>original science image file (can be background-subtracted or not)</li>
<li>original reference image file (can be background-subtracted or not)</li>
<li>a table of candidate transient source(s) found with
transient_detect() or some other tool (can be the name of a table
file or the table itself)
note: if pixcoords=False, the table must have at least the columns
“ra” and “dec”; if pixcoords=True, the table must have at least the
columns “xcentroid” and “ycentroid”</li>
<li>whether to use the pixel coordinates of the transients when plotting
rather than the ra, dec (optional; default False; recommended to use
in cases where it is not clear that the WCS of the science and
reference images matches exactly)</li>
<li>the size of each 2D array in the triplet, i.e. the size of the
stamp to obtain around the transient(s) (optional; default 200 pix)</li>
<li>mode to use for crop_WCS (optional; default “extend”; options are
“truncate” and “extend”)</li>
<li>whether to write the produced triplet(s) to a .npy file (optional;
default True)</li>
<li>name for output .npy file (or some other file) (optional; default
set below)</li>
<li>whether to plot all of the triplets (optional; default False)</li>
</ul>
<p>only relevant if plot=True:
- whether to plot the triplets as 3 columns, 1 row (horizontally wide)</p>
<blockquote>
<div>or 3 rows, 1 column (vertically tall) (optional; default wide=True)</div></blockquote>
<ul class="last simple">
<li>colourmap to apply to all images in the triplet (optional; default
“bone”)</li>
<li>a title to include in all plots AND to append to all filenames
(optional; default None)</li>
<li>name for the directory in which to store all plots (optional;
default set below)</li>
</ul>
</dd>
</dl>
<p>From a table of candidate transients and the corresponding difference,
science, and reference images, builds a triplet: three “postage stamps”
around the candidate showing the science image, reference image, and
difference image. Optionally writes the triplet to a .npy file.</p>
<p>Output: a numpy array with shape (N, 3, size, size), where N is the number
of rows in the input table (i.e., no. of candidate transients) and the 3
sub-arrays represent cropped sections of the science image, reference
image, and difference image</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.im_contains">
<code class="descclassname">amakihi.</code><code class="descname">im_contains</code><span class="sig-paren">(</span><em>im_file</em>, <em>ra</em>, <em>dec</em>, <em>exclusion=None</em>, <em>mute=False</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.im_contains" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>image of interest</li>
<li>ra, dec of interest for a single source</li>
<li>fraction of edge pixels to ignore (optional; default None;
e.g. if exclusion=0.05 and image is 1000x1000, will only consider pix
in range [50, 950] valid for both axes)</li>
<li>mute the warnings (optional; default False)</li>
</ul>
</dd>
</dl>
<p>Check if some coordinate at ra, dec is within the bounds of the image.</p>
<p>Output: bool indicating whether coordinate is in image</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.make_image">
<code class="descclassname">amakihi.</code><code class="descname">make_image</code><span class="sig-paren">(</span><em>im_file</em>, <em>mask_file=None</em>, <em>scale=None</em>, <em>cmap='bone'</em>, <em>label=None</em>, <em>title=None</em>, <em>output=None</em>, <em>target=None</em>, <em>target_small=None</em>, <em>crosshair_big='black'</em>, <em>crosshair_small='#fe019a'</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.make_image" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li>image of interest</li>
<li>bad pixels mask (optional; default None)</li>
<li>scale to use for the image (optional; default None (linear), options
are “linear”, “log”, “asinh”)</li>
<li>colourmap to use for the image (optional; default is “bone”)</li>
<li>label to apply to the colourbar (optional; default set below)</li>
<li>title for the image (optional; default None)</li>
<li>name for the output file (optional; default set below)</li>
<li>[ra,dec] for a target at which to place a crosshair (optional;
default None)</li>
<li>[ra,dec] for a second target at which to place a smaller crosshair
(optional; default None)</li>
<li>colour for the big crosshair (optional; default “black”)</li>
<li>colour for the small crosshair (optional; default hot pink)</li>
</ul>
</dd>
</dl>
<p>Output: None</p>
</dd></dl>

<dl class="function">
<dt id="amakihi.transient_stamp">
<code class="descclassname">amakihi.</code><code class="descname">transient_stamp</code><span class="sig-paren">(</span><em>im_file</em>, <em>target</em>, <em>size=200.0</em>, <em>cropmode='truncate'</em>, <em>scale=None</em>, <em>cmap='bone'</em>, <em>label=None</em>, <em>crosshair='#fe019a'</em>, <em>title=None</em>, <em>output=None</em>, <em>toi=None</em><span class="sig-paren">)</span><a class="headerlink" href="#amakihi.transient_stamp" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Inputs:</dt>
<dd><ul class="first last simple">
<li>image of interest</li>
<li>[ra, dec] of a candidate transient source</li>
<li>size of the zoomed-in region around the transient to plot in pixels
(optional; default 200.0)</li>
<li>mode to use for crop_WCS (optional; default “truncate”; options are
“truncate” and “extend”)</li>
<li>scale to apply to the image (optional; default None (linear); options
are “linear”, “log”, “asinh”)</li>
<li>colourmap to use for the image (optional; default is “bone”)</li>
<li>label to apply to the colourbar (optional; defaults set below)</li>
<li>colour for the crosshairs (optional; default is ~ hot pink)</li>
<li>title for the image (optional; defaults set below)</li>
<li>name for the output file (optional; defaults set below)</li>
<li>[ra, dec] of some other source of interest (optional; default None)</li>
</ul>
</dd>
</dl>
<p>Output: None</p>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="astroalign_mod.html" class="btn btn-neutral float-right" title="astroalign_mod module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="modules.html" class="btn btn-neutral float-left" title="amakihi" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Nicholas Vieira

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>